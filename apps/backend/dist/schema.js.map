{"version":3,"sources":["../src/schema.ts"],"sourcesContent":["import { createSchema } from \"graphql-yoga\";\nimport { loadFilesSync } from \"@graphql-tools/load-files\";\nimport {\n  MutationResolvers,\n  QueryResolvers,\n} from \"./lib/generated/resolver-types\";\nimport { gpt4v, img2img, s3_upload } from \"./utilities\";\n\nconst query_resolvers: QueryResolvers = {\n  hello: async (_parent, _args, _context, _info) => {\n    return {\n      message: \"Hello World!\",\n      url: \"https://google.com\",\n    };\n  },\n};\n\nconst mutation_resolvers: MutationResolvers = {\n  process_image: async (_parent, args, _context, _info) => {\n    const {\n      camera_image: camera_image_maybe,\n      original_image: original_image_maybe,\n    } = args;\n\n    if (!camera_image_maybe) throw new Error(\"Missing camera image.\");\n    if (!original_image_maybe) throw new Error(\"Missing original image.\");\n\n    // ÁîªÂÉè„ÇíË™≠„ÅøËæº„Çì„ÅßËß£Ë™¨„Åô„Çã\n    const describe = await gpt4v(camera_image_maybe);\n\n    console.debug(\"[üí≠] „Éó„É≠„É≥„Éó„Éà: \", describe);\n\n    // ÁîªÂÉè„ÇíÂ§âÊèõ„Åô„Çã\n    const result = await img2img(describe || \"perfect\", original_image_maybe);\n    console.debug(\"[üñº] Â§âÊèõÂÆå‰∫Ü\");\n    // console.debug(\"[üñº] Â§âÊèõÁµêÊûú: \", result);\n\n    // s3„Å´„Ç¢„ÉÉ„Éó„É≠„Éº„Éâ„Åô„Çã\n    const result_upload = await s3_upload(result);\n    console.debug(`https://pub-ff76be015fe2485bb8d12628f4d70b12.r2.dev/${result_upload.filename}`);\n\n    return {\n      url: `https://pub-ff76be015fe2485bb8d12628f4d70b12.r2.dev/${result_upload.filename}`,\n    };\n  },\n};\n\nexport const schema = createSchema({\n  typeDefs: [loadFilesSync(\"../../schema.graphql\")],\n  resolvers: {\n    Query: query_resolvers,\n    Mutation: mutation_resolvers,\n  },\n});\n"],"names":["createSchema","loadFilesSync","gpt4v","img2img","s3_upload","query_resolvers","hello","_parent","_args","_context","_info","message","url","mutation_resolvers","process_image","args","camera_image","camera_image_maybe","original_image","original_image_maybe","Error","describe","console","debug","result","result_upload","filename","schema","typeDefs","resolvers","Query","Mutation"],"mappings":"AAAA,SAASA,YAAY,QAAQ,eAAe;AAC5C,SAASC,aAAa,QAAQ,4BAA4B;AAK1D,SAASC,KAAK,EAAEC,OAAO,EAAEC,SAAS,QAAQ,cAAc;AAExD,MAAMC,kBAAkC;IACtCC,OAAO,OAAOC,SAASC,OAAOC,UAAUC;QACtC,OAAO;YACLC,SAAS;YACTC,KAAK;QACP;IACF;AACF;AAEA,MAAMC,qBAAwC;IAC5CC,eAAe,OAAOP,SAASQ,MAAMN,UAAUC;QAC7C,MAAM,EACJM,cAAcC,kBAAkB,EAChCC,gBAAgBC,oBAAoB,EACrC,GAAGJ;QAEJ,IAAI,CAACE,oBAAoB,MAAM,IAAIG,MAAM;QACzC,IAAI,CAACD,sBAAsB,MAAM,IAAIC,MAAM;QAE3C,eAAe;QACf,MAAMC,WAAW,MAAMnB,MAAMe;QAE7BK,QAAQC,KAAK,CAAC,gBAAgBF;QAE9B,UAAU;QACV,MAAMG,SAAS,MAAMrB,QAAQkB,YAAY,WAAWF;QACpDG,QAAQC,KAAK,CAAC;QACd,wCAAwC;QAExC,cAAc;QACd,MAAME,gBAAgB,MAAMrB,UAAUoB;QACtCF,QAAQC,KAAK,CAAC,CAAC,oDAAoD,EAAEE,cAAcC,QAAQ,CAAC,CAAC;QAE7F,OAAO;YACLd,KAAK,CAAC,oDAAoD,EAAEa,cAAcC,QAAQ,CAAC,CAAC;QACtF;IACF;AACF;AAEA,OAAO,MAAMC,SAAS3B,aAAa;IACjC4B,UAAU;QAAC3B,cAAc;KAAwB;IACjD4B,WAAW;QACTC,OAAOzB;QACP0B,UAAUlB;IACZ;AACF,GAAG"}